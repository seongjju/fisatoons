<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>{{ webtoon['title'] }} ìƒì„¸ ì •ë³´</h1>

    {% if no_data %}
        <p>ğŸš¨ í•´ë‹¹ ì›¹íˆ°ì˜ ì˜ˆì¸¡ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% else %}
        <!-- âœ… ë³„ì  ì˜ˆì¸¡ ê·¸ë˜í”„ -->
        <h2>â­ ë³„ì  ì˜ˆì¸¡ ë¹„êµ</h2>
        <canvas id="ratingChart"></canvas>

        <!-- âœ… ê°ì„± íŠ¸ë Œë“œ ê·¸ë˜í”„ -->
        <h2>ğŸ“Š ê°ì„± íŠ¸ë Œë“œ</h2>
        <canvas id="sentimentChart"></canvas>

        <!-- âœ… ì˜¤ì°¨ ë¶„ì„ ê·¸ë˜í”„ -->
        <h2>ğŸ“‰ ì˜¤ì°¨ ë¶„ì„ (ì—í”¼ì†Œë“œë³„ ì˜¤ì°¨)</h2>
        <canvas id="residualChart"></canvas>

        <!-- âœ… ì˜¤ì°¨ íˆìŠ¤í† ê·¸ë¨ ê·¸ë˜í”„ -->
        <h2>ğŸ“Š ì˜¤ì°¨ íˆìŠ¤í† ê·¸ë¨ (ì „ì²´ ë°ì´í„°)</h2>
        <canvas id="residualHistogram"></canvas>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let episodeNumbers = JSON.parse('{{ episode_numbers | safe }}');

                let actualRatings = JSON.parse('{{ actual_ratings | safe }}');
                let model1Predictions = JSON.parse('{{ model_1_predictions | safe }}');
                let model2Predictions = JSON.parse('{{ model_2_predictions | safe }}');
                let model3Predictions = JSON.parse('{{ model_3_predictions | safe }}');

                let positiveRatio = JSON.parse('{{ positive_ratio | safe }}');
                let negativeRatio = JSON.parse('{{ negative_ratio | safe }}');

                let residuals = JSON.parse('{{ residuals | safe }}');
                let histogramBins = JSON.parse('{{ histogram_bins | safe }}');
                let histogramValues = JSON.parse('{{ histogram_values | safe }}');

                // âœ… ë³„ì  ì˜ˆì¸¡ ê·¸ë˜í”„
                new Chart(document.getElementById("ratingChart"), {
                    type: "line",
                    data: {
                        labels: episodeNumbers,
                        datasets: [
                            { label: "ì‹¤ì œ ë³„ì ", borderColor: "#ff4757", data: actualRatings, fill: false },
                            { label: "ì„ í˜• íšŒê·€ ì˜ˆì¸¡", borderColor: "#1e90ff", data: model1Predictions, fill: false },
                            { label: "ëœë¤ í¬ë ˆìŠ¤íŠ¸ ì˜ˆì¸¡", borderColor: "#2ed573", data: model2Predictions, fill: false },
                            { label: "LSTM ì˜ˆì¸¡", borderColor: "#ffa502", data: model3Predictions, fill: false }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { title: { display: true, text: "ë³„ì " } },
                            x: { title: { display: true, text: "ì—í”¼ì†Œë“œ" } }
                        }
                    }
                });

                // âœ… ê°ì„± íŠ¸ë Œë“œ ê·¸ë˜í”„
                new Chart(document.getElementById("sentimentChart"), {
                    type: "line",
                    data: {
                        labels: episodeNumbers,
                        datasets: [
                            { label: "ê¸ì •ë¹„ìœ¨", borderColor: "#008000", data: positiveRatio, fill: false },
                            { label: "ë¶€ì •ë¹„ìœ¨", borderColor: "#ff0000", data: negativeRatio, fill: false }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { title: { display: true, text: "ë¹„ìœ¨" } },
                            x: { title: { display: true, text: "ì—í”¼ì†Œë“œ" } }
                        }
                    }
                });

                // âœ… ì˜¤ì°¨ ë¶„ì„ ê·¸ë˜í”„ (ì—í”¼ì†Œë“œë³„ ì˜¤ì°¨)
                new Chart(document.getElementById("residualChart"), {
                    type: "bar",
                    data: {
                        labels: episodeNumbers,
                        datasets: [{
                            label: "ì˜ˆì¸¡ ì˜¤ì°¨ (ì‹¤ì œ - ì„ í˜•íšŒê·€)",
                            backgroundColor: "#ffcc00",
                            data: residuals
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { title: { display: true, text: "ì˜¤ì°¨" } },
                            x: { title: { display: true, text: "ì—í”¼ì†Œë“œ" } }
                        }
                    }
                });

                // âœ… ì˜¤ì°¨ íˆìŠ¤í† ê·¸ë¨ ê·¸ë˜í”„ (ì „ì²´ ë°ì´í„°)
                new Chart(document.getElementById("residualHistogram"), {
                    type: "bar",
                    data: {
                        labels: histogramBins.map(bin => bin.toFixed(2)),
                        datasets: [{
                            label: "ì˜ˆì¸¡ ì˜¤ì°¨ ë¶„í¬",
                            backgroundColor: "rgba(255, 99, 132, 0.6)",
                            borderColor: "rgba(255, 99, 132, 1)",
                            borderWidth: 1,
                            data: histogramValues
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { title: { display: true, text: "ì˜¤ì°¨ (ì‹¤ì œë³„ì  - ì˜ˆì¸¡ë³„ì )" } },
                            y: { title: { display: true, text: "ë¹ˆë„" } }
                        }
                    }
                });

            });
        </script>
    {% endif %}

    <!-- ğŸ”™ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
    <a href="/" class="back-button">ğŸ”™ ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
</body>
</html>